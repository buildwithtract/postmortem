<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tract Postmortem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cream: '#FEFCF2',
                        textcolor: '#544c43',
                        primary: '#8ea75f',
                        alt: '#FFB097',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .comment-jamie {
            border-left: 3px solid #8ea75f;
        }
        .comment-henry {
            border-left: 3px solid #FFB097;
        }
        .annotation {
            background-color: rgba(142, 167, 95, 0.1);
            border-bottom: 2px dotted #8ea75f;
            cursor: pointer;
            position: relative;
        }
        .comment-indicator {
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-left: 4px;
            font-size: 12px;
            color: #8ea75f;
            display: none;
        }
        .reference {
            color: #8ea75f;
            font-weight: 500;
            text-decoration: none;
        }
        .reference:hover {
            text-decoration: underline;
        }
        .ref-indicator {
            vertical-align: super;
            font-size: 0.75em;
            font-weight: bold;
            color: #8ea75f;
        }
        @media (min-width: 1024px) {
            .comment-indicator {
                display: block;
            }
        }
        .comment-tooltip {
            display: none;
            position: absolute;
            z-index: 100;
            width: 300px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 12px;
            top: -10px;
            left: calc(100% + 10px);
        }
        .reply {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(84, 76, 67, 0.1);
            margin-left: 16px;
        }
        .ref-card {
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }
        .ref-card:hover {
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .ref-card.highlight {
            background-color: rgba(142, 167, 95, 0.1);
        }
        .section-summary {
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
            border-left: 3px solid #8ea75f;
            opacity: 0.6;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .section-summary:hover {
            background-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .section-summary.active {
            opacity: 1;
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        @media print {
            .sidebar-left, .sidebar-right {
                display: none;
            }
            .document {
                margin: 0;
                max-width: 100%;
                box-shadow: none;
            }
            .annotation {
                background-color: transparent;
                border-bottom: none;
            }
            .comment-indicator, .comment-tooltip {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-cream text-textcolor">
    <div class="container mx-auto py-10 px-4">
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Left sidebar (visible on desktop only) -->
            <aside class="sidebar-left hidden lg:block lg:w-1/4 sticky top-10 self-start">
                <nav class="space-y-6">
                    <h3 class="font-bold text-lg mb-3">Contents</h3>
                    
                    <div id="section-summaries" class="space-y-4">
                        <div id="intro-summary" class="section-summary" data-for="intro">
                            <h4 class="text-sm font-bold text-primary">Introduction</h4>
                            <p class="text-xs mt-1">
                                A reflection on our two-year journey building Tract, a data pipeline startup that attempted to solve infrastructure challenges for growing companies but ultimately failed to find sustainable product-market fit.
                            </p>
                        </div>
                        
                        <div id="timeline-summary" class="section-summary" data-for="timeline">
                            <h4 class="text-sm font-bold text-primary">Timeline</h4>
                            <p class="text-xs mt-1">
                                From founding in January 2023 to shutdown in February 2025, our key milestones included incorporation, initial MVP release, and eventually the difficult decision to close operations after funding challenges.
                            </p>
                        </div>
                        
                        <div id="whatwentwrong-summary" class="section-summary" data-for="whatwentwrong">
                            <h4 class="text-sm font-bold text-primary">What Went Wrong</h4>
                            <p class="text-xs mt-1">
                                Three key factors led to our failure: lack of product-market fit, scattered go-to-market strategy across too many customer segments, and misjudging the time needed to raise additional funding.
                            </p>
                        </div>
                        
                        <div id="lessonslearned-summary" class="section-summary" data-for="lessonslearned">
                            <h4 class="text-sm font-bold text-primary">Lessons Learned</h4>
                            <p class="text-xs mt-1">
                                Key takeaways include focusing on hair-on-fire problems, targeting specific customer segments with overwhelming value, and measuring metrics that actually indicate product-market fit.
                            </p>
                        </div>
                    </div>
                    
                    <div class="mt-2">
                        <h3 class="font-bold text-lg mb-3">Key Stats</h3>
                        <div class="space-y-2">
                            <div class="p-3 bg-white/70 rounded">
                                <p class="text-sm">Founded: <span class="font-medium">January 2023</span></p>
                            </div>
                            <div class="p-3 bg-white/70 rounded">
                                <p class="text-sm">Closed: <span class="font-medium">February 2025</span></p>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-bold text-lg mb-3">References</h3>
                        <div class="space-y-2">
                            <div id="ref1" class="ref-card">
                                <p class="text-xs font-semibold text-primary mb-1">[1] Paul Graham</p>
                                <p class="text-sm font-medium"><a href="http://www.paulgraham.com/startupideas.html" target="_blank" class="hover:underline">How to Get Startup Ideas</a></p>
                                <p class="text-xs mt-1">The best startup ideas come from problems you personally experience, not from trying to find a gap in the market.</p>
                            </div>
                            
                            <div id="ref2" class="ref-card">
                                <p class="text-xs font-semibold text-primary mb-1">[2] Paul Graham</p>
                                <p class="text-sm font-medium"><a href="http://paulgraham.com/ds.html" target="_blank" class="hover:underline">Do Things That Don't Scale</a></p>
                                <p class="text-xs mt-1">Many of the most successful startups did things in the early days that wouldn't work at scale.</p>
                            </div>
                            
                            <div id="ref3" class="ref-card">
                                <p class="text-xs font-semibold text-primary mb-1">[3] Marc Andreessen</p>
                                <p class="text-sm font-medium"><a href="https://pmarchive.com/guide_to_startups_part4.html" target="_blank" class="hover:underline">The Only Thing That Matters</a></p>
                                <p class="text-xs mt-1">The most important factor in a startup's success is product/market fit.</p>
                            </div>
                        </div>
                    </div>
                </nav>
            </aside>
            
            <!-- Main content -->
            <main class="document w-full lg:w-1/2 bg-white rounded-lg shadow-lg p-8 lg:p-12 min-h-[50vh]">
                <article>
                    <header class="mb-10 text-center">
                        <h1 class="text-3xl md:text-4xl font-bold mb-4">Tract: A Postmortem</h1>
                        <p class="text-lg text-textcolor/80">What we built, where we went wrong, and what we learned</p>
                        <div class="border-b border-textcolor/20 w-1/3 mx-auto mt-6"></div>
                    </header>
                    
                    <section id="intro" class="mb-12 section-content">
                        <h2 class="text-2xl font-semibold mb-4">Introduction</h2>
                        <p class="mb-4">
                            After two years of building, iterating, and trying to find product-market fit, we're closing down Tract. 
                            This document serves as a reflection on our journey—both the highlights and the missteps.
                        </p>
                        <p>
                            We started Tract with the <a id="mission" href="#comment1" class="annotation">mission of revolutionizing data pipelines for startups<span class="comment-indicator">💬</span></a>. While we're disappointed with the outcome,
                            we believe there's value in sharing our experience transparently with the community.
                        </p>
                    </section>
                    
                    <section id="timeline" class="mb-12 section-content">
                        <h2 class="text-2xl font-semibold mb-4">Timeline</h2>
                        <div class="space-y-6">
                            <div class="border-l-2 border-primary pl-4 pb-4">
                                <h3 class="font-medium text-lg">January 2023: Foundation</h3>
                                <p class="mt-1">Jamie and Henry incorporated the company after discussions about <a id="infrastructure" href="#comment2" class="annotation">building better data infrastructure for growing companies<span class="comment-indicator">💬</span></a>.</p>
                            </div>
                            
                            <div class="border-l-2 border-primary pl-4 pb-4">
                                <h3 class="font-medium text-lg">June 2023: Initial Product</h3>
                                <p class="mt-1">Launched our MVP to a small group of beta users. We followed Paul Graham's advice to <a href="#ref2" class="reference">do things that don't scale<sup class="ref-indicator">[2]</sup></a>, reaching out personally to each potential customer.</p>
                            </div>
                            
                            <div class="border-l-2 border-primary pl-4 pb-4">
                                <h3 class="font-medium text-lg">February 2025: Shutdown</h3>
                                <p class="mt-1">After <a id="funding" href="#comment3" class="annotation">exhausting our options for additional funding<span class="comment-indicator">💬</span></a>, we made the difficult decision to close operations.</p>
                            </div>
                        </div>
                    </section>
                    
                    <section id="whatwentwrong" class="mb-12 section-content">
                        <h2 class="text-2xl font-semibold mb-4">What Went Wrong</h2>
                        <p class="mb-4">
                            We identified several key factors that contributed to our inability to build a sustainable business:
                        </p>
                        
                        <ol class="list-decimal pl-5 space-y-4 mb-6">
                            <li>
                                <strong>Product-Market Fit.</strong> Despite positive early feedback, we struggled to find a <a id="pmf" href="#comment4" class="annotation">compelling value proposition that would drive continuous growth<span class="comment-indicator">💬</span></a>. As Marc Andreessen famously wrote, <a href="#ref3" class="reference">product/market fit is "the only thing that matters"<sup class="ref-indicator">[3]</sup></a> for startups.
                            </li>
                            <li>
                                <strong>Go-to-Market Strategy.</strong> Our early marketing efforts were too scattered, focusing on multiple customer segments instead of doubling down on a specific niche.
                            </li>
                            <li>
                                <strong>Funding Timeline.</strong> We underestimated the time it would take to raise our next round, putting us in a difficult cash position.
                            </li>
                        </ol>
                    </section>
                    
                    <section id="lessonslearned" class="mb-12 section-content">
                        <h2 class="text-2xl font-semibold mb-4">Lessons Learned</h2>
                        <p class="mb-4">
                            While this chapter comes to a close, we're taking away several important insights:
                        </p>
                        
                        <ul class="list-disc pl-5 space-y-4">
                            <li>
                                <strong>Focus on solving a hair-on-fire problem.</strong> Your early product needs to be a painkiller, not a vitamin. Paul Graham's essay on <a href="#ref1" class="reference">how to get startup ideas<sup class="ref-indicator">[1]</sup></a> emphasizes the importance of solving problems that you've personally experienced.
                            </li>
                            <li>
                                <strong>Get more specific earlier.</strong> Find a <a id="customer-segment" href="#comment5" class="annotation">narrow customer segment where you can deliver overwhelming value<span class="comment-indicator">💬</span></a>, then expand from there.
                            </li>
                            <li>
                                <strong>Measure what matters.</strong> We tracked vanity metrics instead of focusing on <a id="technical" href="#comment6" class="annotation">core indicators of product-market fit<span class="comment-indicator">💬</span></a>.
                            </li>
                        </ul>
                    </section>
                    
                    <footer class="mt-16 pt-8 border-t border-textcolor/20 text-center">
                        <p class="text-sm text-textcolor/70">© 2025 — Jamie Rumbelow & Henry Williams</p>
                    </footer>
                </article>
            </main>
            
            <!-- Right sidebar (visible on desktop only) -->
            <aside class="sidebar-right hidden lg:block lg:w-1/4 sticky top-10 self-start">
                <div class="space-y-8">
                    <div>
                        <h3 class="font-bold text-lg mb-3">Comments</h3>
                        
                        <div id="comment1" class="comment-jamie bg-white p-4 rounded-lg shadow-sm mb-6">
                            <div class="mb-2 flex items-center">
                                <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white">J</div>
                                <p class="ml-2 font-medium">Jamie</p>
                            </div>
                            <p class="text-sm">
                                Our original mission statement was much broader. We should have narrowed our focus from day one.
                            </p>
                            
                            <div class="reply mt-3 pt-3 border-t border-textcolor/10">
                                <div class="mb-2 flex items-center">
                                    <div class="w-7 h-7 bg-alt rounded-full flex items-center justify-center text-white">H</div>
                                    <p class="ml-2 font-medium text-sm">Henry</p>
                                </div>
                                <p class="text-sm">
                                    Agreed. The "for startups" part came later, after we realized our enterprise pitch wasn't landing.
                                </p>
                            </div>
                            
                            <div class="mt-3 text-xs text-right">
                                <a href="#mission" class="text-primary hover:underline">View in text →</a>
                            </div>
                        </div>
                        
                        <div id="comment3" class="comment-jamie bg-white p-4 rounded-lg shadow-sm mb-6">
                            <div class="mb-2 flex items-center">
                                <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white">J</div>
                                <p class="ml-2 font-medium">Jamie</p>
                            </div>
                            <p class="text-sm">
                                We should have cut costs earlier and extended our runway by at least 6 months.
                            </p>
                            
                            <div class="reply mt-3 pt-3 border-t border-textcolor/10">
                                <div class="mb-2 flex items-center">
                                    <div class="w-7 h-7 bg-alt rounded-full flex items-center justify-center text-white">H</div>
                                    <p class="ml-2 font-medium text-sm">Henry</p>
                                </div>
                                <p class="text-sm">
                                    The marketing spend in Q4 2024 was probably a mistake given our runway situation.
                                </p>
                            </div>
                            
                            <div class="mt-3 text-xs text-right">
                                <a href="#funding" class="text-primary hover:underline">View in text →</a>
                            </div>
                        </div>
                        
                        <div id="comment5" class="comment-jamie bg-white p-4 rounded-lg shadow-sm mb-6">
                            <div class="mb-2 flex items-center">
                                <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white">J</div>
                                <p class="ml-2 font-medium">Jamie</p>
                            </div>
                            <p class="text-sm">
                                Looking back, I think we should have focused on enterprise customers from the beginning. The sales cycles were longer, but the contracts were more stable.
                            </p>
                            
                            <div class="reply mt-3 pt-3 border-t border-textcolor/10">
                                <div class="mb-2 flex items-center">
                                    <div class="w-7 h-7 bg-alt rounded-full flex items-center justify-center text-white">H</div>
                                    <p class="ml-2 font-medium text-sm">Henry</p>
                                </div>
                                <p class="text-sm">
                                    I was initially resistant to the enterprise focus, but you were right. The smaller customers needed too much handholding.
                                </p>
                                
                                <div class="reply mt-3 pt-3 border-t border-textcolor/10">
                                    <div class="mb-2 flex items-center">
                                        <div class="w-7 h-7 bg-primary rounded-full flex items-center justify-center text-white">J</div>
                                        <p class="ml-2 font-medium text-sm">Jamie</p>
                                    </div>
                                    <p class="text-sm">
                                        The support burden alone was killing us. Remember those late night calls with the Hawaii team?
                                    </p>
                                </div>
                            </div>
                            
                            <div class="mt-3 text-xs text-right">
                                <a href="#customer-segment" class="text-primary hover:underline">View in text →</a>
                            </div>
                        </div>
                        
                        <div id="comment2" class="comment-henry bg-white p-4 rounded-lg shadow-sm mb-6">
                            <div class="mb-2 flex items-center">
                                <div class="w-8 h-8 bg-alt rounded-full flex items-center justify-center text-white">H</div>
                                <p class="ml-2 font-medium">Henry</p>
                            </div>
                            <p class="text-sm">
                                I still believe there's a huge opportunity here, but our approach was too unfocused.
                            </p>
                            
                            <div class="mt-3 text-xs text-right">
                                <a href="#infrastructure" class="text-primary hover:underline">View in text →</a>
                            </div>
                        </div>
                        
                        <div id="comment4" class="comment-henry bg-white p-4 rounded-lg shadow-sm mb-6">
                            <div class="mb-2 flex items-center">
                                <div class="w-8 h-8 bg-alt rounded-full flex items-center justify-center text-white">H</div>
                                <p class="ml-2 font-medium">Henry</p>
                            </div>
                            <p class="text-sm">
                                Our core problem was splitting focus between two different user personas. We should have picked one.
                            </p>
                            
                            <div class="mt-3 text-xs text-right">
                                <a href="#pmf" class="text-primary hover:underline">View in text →</a>
                            </div>
                        </div>
                        
                        <div id="comment6" class="comment-henry bg-white p-4 rounded-lg shadow-sm">
                            <div class="mb-2 flex items-center">
                                <div class="w-8 h-8 bg-alt rounded-full flex items-center justify-center text-white">H</div>
                                <p class="ml-2 font-medium">Henry</p>
                            </div>
                            <p class="text-sm">
                                The technical architecture decisions we made early on proved difficult to scale when we pivoted. Next time, I'd invest more in flexible infrastructure.
                            </p>
                            
                            <div class="mt-3 text-xs text-right">
                                <a href="#technical" class="text-primary hover:underline">View in text →</a>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-bold text-lg mb-3">Resources</h3>
                        <ul class="text-sm space-y-2">
                            <li><a href="#" class="text-primary hover:underline">Source code (GitHub)</a></li>
                            <li><a href="#" class="text-primary hover:underline">Final company blog post</a></li>
                        </ul>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Tooltips container - managed by JS -->
    <div id="tooltips-container"></div>

    <script>
        // Prepare tooltips content
        const tooltipContent = {
            "comment1": {
                author: "Jamie",
                authorColor: "#8ea75f",
                text: "Our original mission statement was much broader. We should have narrowed our focus from day one.",
                replies: [
                    {
                        author: "Henry",
                        authorColor: "#FFB097",
                        text: "Agreed. The \"for startups\" part came later, after we realized our enterprise pitch wasn't landing."
                    }
                ]
            },
            "comment2": {
                author: "Henry",
                authorColor: "#FFB097",
                text: "I still believe there's a huge opportunity here, but our approach was too unfocused.",
                replies: []
            },
            "comment3": {
                author: "Jamie",
                authorColor: "#8ea75f",
                text: "We should have cut costs earlier and extended our runway by at least 6 months.",
                replies: [
                    {
                        author: "Henry",
                        authorColor: "#FFB097",
                        text: "The marketing spend in Q4 2024 was probably a mistake given our runway situation."
                    }
                ]
            },
            "comment4": {
                author: "Henry",
                authorColor: "#FFB097",
                text: "Our core problem was splitting focus between two different user personas. We should have picked one.",
                replies: []
            },
            "comment5": {
                author: "Jamie",
                authorColor: "#8ea75f",
                text: "Looking back, I think we should have focused on enterprise customers from the beginning. The sales cycles were longer, but the contracts were more stable.",
                replies: [
                    {
                        author: "Henry",
                        authorColor: "#FFB097",
                        text: "I was initially resistant to the enterprise focus, but you were right. The smaller customers needed too much handholding.",
                        replies: [
                            {
                                author: "Jamie",
                                authorColor: "#8ea75f",
                                text: "The support burden alone was killing us. Remember those late night calls with the Hawaii team?"
                            }
                        ]
                    }
                ]
            },
            "comment6": {
                author: "Henry",
                authorColor: "#FFB097",
                text: "The technical architecture decisions we made early on proved difficult to scale when we pivoted. Next time, I'd invest more in flexible infrastructure.",
                replies: []
            }
        };

        // Show tooltip when hovering over annotation
        document.querySelectorAll('.annotation').forEach(annotation => {
            const commentId = annotation.getAttribute('href').substring(1);
            const tooltip = tooltipContent[commentId];
            
            if (!tooltip) return;
            
            annotation.addEventListener('mouseenter', function(e) {
                const tooltipEl = createTooltip(tooltip, commentId);
                
                // Position tooltip
                const annotationRect = annotation.getBoundingClientRect();
                tooltipEl.style.position = 'fixed';
                tooltipEl.style.top = (annotationRect.top - 10) + 'px';
                tooltipEl.style.left = (annotationRect.right + 10) + 'px';
                
                document.body.appendChild(tooltipEl);
            });
            
            annotation.addEventListener('mouseleave', function() {
                const existingTooltip = document.querySelector(`.live-tooltip[data-for="${commentId}"]`);
                if (existingTooltip) {
                    existingTooltip.remove();
                }
            });
            
            // Prevent default link behavior so clicking just scrolls to comment
            annotation.addEventListener('click', function(e) {
                e.preventDefault();
                const targetElement = document.getElementById(commentId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                    targetElement.classList.add('bg-alt/10');
                    setTimeout(() => {
                        targetElement.classList.remove('bg-alt/10');
                    }, 1500);
                }
            });
        });
        
        // Create tooltip element
        function createTooltip(tooltip, commentId) {
            const tooltipEl = document.createElement('div');
            tooltipEl.className = 'live-tooltip bg-white p-3 rounded-md shadow-lg z-50';
            tooltipEl.setAttribute('data-for', commentId);
            
            // Author header
            const headerDiv = document.createElement('div');
            headerDiv.className = 'flex items-center mb-2';
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'w-6 h-6 rounded-full flex items-center justify-center text-white text-xs';
            avatarDiv.style.backgroundColor = tooltip.authorColor;
            avatarDiv.textContent = tooltip.author.charAt(0);
            
            const authorP = document.createElement('p');
            authorP.className = 'ml-2 text-xs font-medium';
            authorP.textContent = tooltip.author;
            
            headerDiv.appendChild(avatarDiv);
            headerDiv.appendChild(authorP);
            
            // Comment text
            const textP = document.createElement('p');
            textP.className = 'text-xs';
            textP.textContent = tooltip.text;
            
            // Add to tooltip
            tooltipEl.appendChild(headerDiv);
            tooltipEl.appendChild(textP);
            
            // Add replies
            if (tooltip.replies && tooltip.replies.length > 0) {
                tooltip.replies.forEach(reply => {
                    const replyDiv = document.createElement('div');
                    replyDiv.className = 'reply mt-2 pt-2 border-t border-textcolor/10 ml-3';
                    
                    // Reply author header
                    const replyHeader = document.createElement('div');
                    replyHeader.className = 'flex items-center mb-2';
                    
                    const replyAvatar = document.createElement('div');
                    replyAvatar.className = 'w-5 h-5 rounded-full flex items-center justify-center text-white text-xs';
                    replyAvatar.style.backgroundColor = reply.authorColor;
                    replyAvatar.textContent = reply.author.charAt(0);
                    
                    const replyAuthor = document.createElement('p');
                    replyAuthor.className = 'ml-2 text-xs font-medium';
                    replyAuthor.textContent = reply.author;
                    
                    replyHeader.appendChild(replyAvatar);
                    replyHeader.appendChild(replyAuthor);
                    
                    // Reply text
                    const replyText = document.createElement('p');
                    replyText.className = 'text-xs';
                    replyText.textContent = reply.text;
                    
                    replyDiv.appendChild(replyHeader);
                    replyDiv.appendChild(replyText);
                    
                    // Add nested replies if any
                    if (reply.replies && reply.replies.length > 0) {
                        reply.replies.forEach(nestedReply => {
                            const nestedDiv = document.createElement('div');
                            nestedDiv.className = 'reply mt-2 pt-2 border-t border-textcolor/10 ml-3';
                            
                            // Nested reply author header
                            const nestedHeader = document.createElement('div');
                            nestedHeader.className = 'flex items-center mb-2';
                            
                            const nestedAvatar = document.createElement('div');
                            nestedAvatar.className = 'w-5 h-5 rounded-full flex items-center justify-center text-white text-xs';
                            nestedAvatar.style.backgroundColor = nestedReply.authorColor;
                            nestedAvatar.textContent = nestedReply.author.charAt(0);
                            
                            const nestedAuthor = document.createElement('p');
                            nestedAuthor.className = 'ml-2 text-xs font-medium';
                            nestedAuthor.textContent = nestedReply.author;
                            
                            nestedHeader.appendChild(nestedAvatar);
                            nestedHeader.appendChild(nestedAuthor);
                            
                            // Nested reply text
                            const nestedText = document.createElement('p');
                            nestedText.className = 'text-xs';
                            nestedText.textContent = nestedReply.text;
                            
                            nestedDiv.appendChild(nestedHeader);
                            nestedDiv.appendChild(nestedText);
                            
                            replyDiv.appendChild(nestedDiv);
                        });
                    }
                    
                    tooltipEl.appendChild(replyDiv);
                });
            }
            
            tooltipEl.style.width = '300px';
            return tooltipEl;
        }

        // Add scrolling to annotation when comment link is clicked
        document.querySelectorAll('.comment-jamie a, .comment-henry a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                    targetElement.classList.add('bg-primary/20');
                    setTimeout(() => {
                        targetElement.classList.remove('bg-primary/20');
                    }, 1500);
                }
            });
        });

        // Handle reference links
        document.querySelectorAll('.reference').forEach(reference => {
            reference.addEventListener('click', function(e) {
                e.preventDefault();
                const refId = this.getAttribute('href');
                const refElement = document.querySelector(refId);
                
                // First clear any existing highlights
                document.querySelectorAll('.ref-card').forEach(card => {
                    card.classList.remove('highlight');
                });
                
                // Highlight the reference card
                if (refElement) {
                    refElement.scrollIntoView({ behavior: 'smooth' });
                    refElement.classList.add('highlight');
                    setTimeout(() => {
                        refElement.classList.remove('highlight');
                    }, 3000);
                }
            });
        });

        // Make section summaries clickable
        document.querySelectorAll('.section-summary').forEach(summary => {
            summary.addEventListener('click', function() {
                const sectionId = this.getAttribute('data-for');
                const sectionElement = document.getElementById(sectionId);
                
                if (sectionElement) {
                    sectionElement.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // Intersection observer for section highlighting
        const sectionObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                // Get the corresponding summary
                const sectionId = entry.target.id;
                const summary = document.getElementById(`${sectionId}-summary`);
                
                if (entry.isIntersecting) {
                    // When section is visible, highlight the summary
                    if (summary) {
                        // First remove active class from all summaries
                        document.querySelectorAll('.section-summary').forEach(s => {
                            s.classList.remove('active');
                        });
                        
                        // Add active class to this summary
                        summary.classList.add('active');
                    }
                }
            });
        }, { threshold: 0.4 }); // Trigger when section is 40% visible
        
        // Observe all sections
        document.querySelectorAll('.section-content').forEach(section => {
            sectionObserver.observe(section);
        });
        
        // Initialize the first summary as active
        const firstSummary = document.querySelector('.section-summary');
        if (firstSummary) {
            firstSummary.classList.add('active');
        }
    </script>
</body>
</html>